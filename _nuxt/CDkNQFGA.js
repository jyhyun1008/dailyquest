import{_ as A}from"./BDh3DLF0.js";import{q as C,r as i,j as U,c as b,a as o,b as w,w as y,k as I,v as S,l as k,m as V,F as q,o as R,d as x}from"./Bk7B2AK8.js";let f;f=globalThis.crypto;async function N(n){return(await f).getRandomValues(new Uint8Array(n))}async function T(n){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let a="";const r=await N(n);for(let l=0;l<n;l++){const s=r[l]%t.length;a+=t[s]}return a}async function B(n){return await T(n)}async function D(n){const t=await(await f).subtle.digest("SHA-256",new TextEncoder().encode(n));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function z(n){const t=await B(n),a=await D(t);return{code_verifier:t,code_challenge:a}}const E={class:"h-app"},F={id:"parent-wrapper"},M={id:"quest-wrapper"},j={class:"button-flex"},H={class:"quest-button"},G={__name:"login",async setup(n){let t,a;var r="";const l=([t,a]=C(()=>z(128)),t=await t,a(),t),s=i(null),g=i(null),c=i(null),u=i(null),d=i(null),p=l.code_challenge,h=l.code_verifier;async function $(_){const e=await $fetch(`https://${_}/.well-known/oauth-authorization-server`);console.log(e),s.value=e.authorization_endpoint,g.value=e.token_endpoint,localStorage.setItem("token_endpoint",g.value),localStorage.setItem("host",_),localStorage.setItem("code_verifier",h),console.log(`${s.value}?client_id=${d.value}&response_type=code&redirect_uri=${u.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${p}&code_challenge_method=S256&state=${c.value}`),location.href=`${s.value}?client_id=${d.value}&response_type=code&redirect_uri=${u.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${p}&code_challenge_method=S256&state=${c.value}`}return U(()=>{console.log(h,p),u.value=encodeURIComponent("https://quest.howeverina.studio/redirect"),d.value=encodeURIComponent("https://quest.howeverina.studio/login"),c.value=window.crypto.randomUUID(),console.log("state",c.value)}),(_,e)=>{const m=A;return R(),b(q,null,[e[5]||(e[5]=o("link",{rel:"redirect_uri",href:"/redirect"},null,-1)),o("div",E,[w(m,{to:"/",class:"u-url p-name"},{default:y(()=>[...e[2]||(e[2]=[x("DailyQuest",-1)])]),_:1})]),o("div",F,[o("div",M,[e[4]||(e[4]=o("h3",null,"서버 주소를 입력해주세요.",-1)),I(o("input",{"onUpdate:modelValue":e[0]||(e[0]=v=>V(r)?r.value=v:r=v),placeholder:"서버 주소"},null,512),[[S,k(r)]]),o("div",j,[o("span",H,[w(m,{to:"/about/"},{default:y(()=>[...e[3]||(e[3]=[x("소개",-1)])]),_:1})]),o("span",{class:"quest-button",onClick:e[1]||(e[1]=v=>$(k(r)))},"로그인")])])])],64)}}};export{G as default};
