import{_ as w}from"./DXsabBS3.js";import{r as o,j as y,c as $,a as t,l as A,v as k,k as h,m as C,b as x,w as U,F as b,o as I,d as S}from"./D45bH7k1.js";const V={id:"parent-wrapper"},q={id:"quest-wrapper"},B={class:"h-app"},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-._~",T={__name:"login",setup(M){var a="";async function f(n){const p=new TextEncoder().encode(n),l=await window.crypto.subtle.digest("SHA-256",p),m=Array.from(new Uint8Array(l));return btoa(String.fromCharCode.apply(null,m)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const i=o(null),v=o(null),r=o(null),s=o(null),u=o(null),d=o(null),c=o(null);async function g(n){const e=await $fetch(`https://${n}/.well-known/oauth-authorization-server`);console.log(e),i.value=e.authorization_endpoint,v.value=e.token_endpoint,localStorage.setItem("token_endpoint",v.value),console.log(`${i.value}?client_id=${d.value}&response_type=code&redirect_uri=${u.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${r.value}&code_challenge_method=S256&state=${s.value}`),location.href=`${i.value}?client_id=${d.value}&response_type=code&redirect_uri=${u.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${r.value}&code_challenge_method=S256&state=${s.value}`}return y(()=>{c.value=new Array(128).fill(0).map(()=>_[Math.floor(_.length*Math.random())]).join(""),console.log("code_verifier",c.value),localStorage.setItem("code_verifier",c.value),(async()=>{try{r.value=await f(c),console.log("code_challenge",r.value)}catch(n){console.error("Code challenge 생성 오류:",n)}})(),u.value=encodeURIComponent("https://quest.howeverina.studio/redirect"),d.value=encodeURIComponent("https://quest.howeverina.studio/login"),s.value=window.crypto.randomUUID(),console.log("state",s.value)}),(n,e)=>{const p=w;return I(),$(b,null,[e[4]||(e[4]=t("link",{rel:"redirect_uri",href:"/redirect"},null,-1)),t("div",V,[t("div",q,[e[2]||(e[2]=t("h3",null,"서버 주소를 입력해주세요.",-1)),A(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>C(a)?a.value=l:a=l),placeholder:"서버 주소"},null,512),[[k,h(a)]]),t("div",{class:"quest-done",onClick:e[1]||(e[1]=l=>g(h(a)))},"로그인")])]),t("div",B,[x(p,{to:"/",class:"u-url p-name"},{default:U(()=>[...e[3]||(e[3]=[S("DailyQuest",-1)])]),_:1})])],64)}}};export{T as default};
