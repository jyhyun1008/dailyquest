import{_ as k}from"./3bEa2rYO.js";import{q as $,r as i,j as x,c as A,a as r,b as C,w as U,k as I,v as S,l as w,m as V,F as b,o as R,d as q}from"./Cmva7bMt.js";let v;v=globalThis.crypto;async function N(e){return(await v).getRandomValues(new Uint8Array(e))}async function T(e){const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let o="";const a=await N(e);for(let l=0;l<e;l++){const s=a[l]%n.length;o+=n[s]}return o}async function B(e){return await T(e)}async function D(e){const n=await(await v).subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(n))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function E(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const n=await B(e),o=await D(n);return{code_verifier:n,code_challenge:o}}const z={class:"h-app"},F={id:"parent-wrapper"},M={id:"quest-wrapper"},L={__name:"login",async setup(e){let n,o;var a="";const l=([n,o]=$(()=>E()),n=await n,o(),n),s=i(null),f=i(null),m=l.code_challenge,c=i(null),d=i(null),u=i(null),h=l.code_verifier;async function g(p){const t=await $fetch(`https://${p}/.well-known/oauth-authorization-server`);console.log(t),s.value=t.authorization_endpoint,f.value=t.token_endpoint,localStorage.setItem("token_endpoint",f.value),localStorage.setItem("host",p),console.log(`${s.value}?client_id=${u.value}&response_type=code&redirect_uri=${d.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${m}&code_challenge_method=S256&state=${c.value}`),location.href=`${s.value}?client_id=${u.value}&response_type=code&redirect_uri=${d.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${m}&code_challenge_method=S256&state=${c.value}`}return x(()=>{localStorage.setItem("code_verifier",h),d.value=encodeURIComponent("https://quest.howeverina.studio/redirect"),u.value=encodeURIComponent("https://quest.howeverina.studio/login"),c.value=window.crypto.randomUUID(),console.log("state",c.value)}),(p,t)=>{const y=k;return R(),A(b,null,[t[4]||(t[4]=r("link",{rel:"redirect_uri",href:"/redirect"},null,-1)),r("div",z,[C(y,{to:"/",class:"u-url p-name"},{default:U(()=>[...t[2]||(t[2]=[q("DailyQuest",-1)])]),_:1})]),r("div",F,[r("div",M,[t[3]||(t[3]=r("h3",null,"서버 주소를 입력해주세요.",-1)),I(r("input",{"onUpdate:modelValue":t[0]||(t[0]=_=>V(a)?a.value=_:a=_),placeholder:"서버 주소"},null,512),[[S,w(a)]]),r("div",{class:"quest-done",onClick:t[1]||(t[1]=_=>g(w(a)))},"로그인")])])],64)}}};export{L as default};
