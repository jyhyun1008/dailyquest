import{_ as k}from"./DgkP9XJ6.js";import{q as $,r as i,j as x,c as A,a as r,k as C,v as U,l as h,m as I,b as S,w as V,F as b,o as R,d as q}from"./D7dTJq1J.js";let _;_=globalThis.crypto;async function N(e){return(await _).getRandomValues(new Uint8Array(e))}async function T(e){const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let a="";const o=await N(e);for(let l=0;l<e;l++){const s=o[l]%n.length;a+=n[s]}return a}async function B(e){return await T(e)}async function D(e){const n=await(await _).subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(n))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function E(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const n=await B(e),a=await D(n);return{code_verifier:n,code_challenge:a}}const z={id:"parent-wrapper"},F={id:"quest-wrapper"},M={class:"h-app"},L={__name:"login",async setup(e){let n,a;var o="";const l=([n,a]=$(()=>E()),n=await n,a(),n),s=i(null),v=i(null),f=l.code_challenge,c=i(null),d=i(null),u=i(null),w=l.code_verifier;async function g(m){const t=await $fetch(`https://${m}/.well-known/oauth-authorization-server`);console.log(t),s.value=t.authorization_endpoint,v.value=t.token_endpoint,localStorage.setItem("token_endpoint",v.value),console.log(`${s.value}?client_id=${u.value}&response_type=code&redirect_uri=${d.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${f.value}&code_challenge_method=S256&state=${c.value}`),location.href=`${s.value}?client_id=${u.value}&response_type=code&redirect_uri=${d.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${f}&code_challenge_method=S256&state=${c.value}`}return x(()=>{localStorage.setItem("code_verifier",w),localStorage.setItem("host",o),d.value=encodeURIComponent("https://quest.howeverina.studio/redirect"),u.value=encodeURIComponent("https://quest.howeverina.studio/login"),c.value=window.crypto.randomUUID(),console.log("state",c.value)}),(m,t)=>{const y=k;return R(),A(b,null,[t[4]||(t[4]=r("link",{rel:"redirect_uri",href:"/redirect"},null,-1)),r("div",z,[r("div",F,[t[2]||(t[2]=r("h3",null,"서버 주소를 입력해주세요.",-1)),C(r("input",{"onUpdate:modelValue":t[0]||(t[0]=p=>I(o)?o.value=p:o=p),placeholder:"서버 주소"},null,512),[[U,h(o)]]),r("div",{class:"quest-done",onClick:t[1]||(t[1]=p=>g(h(o)))},"로그인")])]),r("div",M,[S(y,{to:"/",class:"u-url p-name"},{default:V(()=>[...t[3]||(t[3]=[q("DailyQuest",-1)])]),_:1})])],64)}}};export{L as default};
