import{_ as k}from"./Csc9ainO.js";import{q as $,r as i,j as x,c as A,a as r,b as C,w as U,k as I,v as S,l as f,m as V,F as b,o as q,d as R}from"./CFgs2USP.js";let v;v=globalThis.crypto;async function N(n){return(await v).getRandomValues(new Uint8Array(n))}async function T(n){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let o="";const a=await N(n);for(let l=0;l<n;l++){const s=a[l]%t.length;o+=t[s]}return o}async function B(n){return await T(n)}async function D(n){const t=await(await v).subtle.digest("SHA-256",new TextEncoder().encode(n));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function z(n){const t=await B(n),o=await D(t);return{code_verifier:t,code_challenge:o}}const E={class:"h-app"},F={id:"parent-wrapper"},M={id:"quest-wrapper"},L={__name:"login",async setup(n){let t,o;var a="";const l=([t,o]=$(()=>z(128)),t=await t,o(),t),s=i(null),g=i(null),h=l.code_challenge,c=i(null),d=i(null),u=i(null),m=l.code_verifier;async function w(p){const e=await $fetch(`https://${p}/.well-known/oauth-authorization-server`);console.log(e),s.value=e.authorization_endpoint,g.value=e.token_endpoint,localStorage.setItem("token_endpoint",g.value),localStorage.setItem("host",p),console.log(`${s.value}?client_id=${u.value}&response_type=code&redirect_uri=${d.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${h}&code_challenge_method=S256&state=${c.value}`),location.href=`${s.value}?client_id=${u.value}&response_type=code&redirect_uri=${d.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${h}&code_challenge_method=S256&state=${c.value}`}return x(()=>{localStorage.setItem("code_verifier",m),d.value=encodeURIComponent("https://quest.howeverina.studio/redirect"),u.value=encodeURIComponent("https://quest.howeverina.studio/login"),c.value=window.crypto.randomUUID(),console.log("state",c.value)}),(p,e)=>{const y=k;return q(),A(b,null,[e[4]||(e[4]=r("link",{rel:"redirect_uri",href:"/redirect"},null,-1)),r("div",E,[C(y,{to:"/",class:"u-url p-name"},{default:U(()=>[...e[2]||(e[2]=[R("DailyQuest",-1)])]),_:1})]),r("div",F,[r("div",M,[e[3]||(e[3]=r("h3",null,"서버 주소를 입력해주세요.",-1)),I(r("input",{"onUpdate:modelValue":e[0]||(e[0]=_=>V(a)?a.value=_:a=_),placeholder:"서버 주소"},null,512),[[S,f(a)]]),r("div",{class:"quest-done",onClick:e[1]||(e[1]=_=>w(f(a)))},"로그인")])])],64)}}};export{L as default};
