import{_ as m}from"./CK0BT890.js";import{r as n,j as w,c as y,a as t,l as $,v as A,k as p,m as C,b as k,w as x,F as U,o as b,d as I}from"./aF6nRtG8.js";const S={id:"parent-wrapper"},V={id:"quest-wrapper"},q={class:"h-app"},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-._~",R={__name:"login",setup(B){var a="";async function v(o){const u=new TextEncoder().encode(o),r=await window.crypto.subtle.digest("SHA-256",u),g=Array.from(new Uint8Array(r));return btoa(String.fromCharCode.apply(null,g)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const c=n(null),_=n(null),l=n(null),s=n(null),i=n(null),d=n(null);async function f(o){const e=await $fetch(`https://${o}/.well-known/oauth-authorization-server`);console.log(e),c.value=e.authorization_endpoint,_.value=e.token_endpoint,console.log(`${c.value}?client_id=${d.value}&response_type=code&redirect_uri=${i.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${l.value}&code_challenge_method=S256&state=${s.value}`),location.href=`${c.value}?client_id=${d.value}&response_type=code&redirect_uri=${i.value}&scope=read%3Aaccount%20write%3Anotes%20read%3Areactions&code_challenge=${l.value}&code_challenge_method=S256&state=${s.value}`}return w(()=>{const o=new Array(128).fill(0).map(()=>h[Math.floor(h.length*Math.random())]).join("");console.log("code_verifier",o),localStorage.setItem("code_verifier",o),(async()=>{try{l.value=await v(o),console.log("code_challenge",l.value)}catch(e){console.error("Code challenge 생성 오류:",e)}})(),i.value=encodeURIComponent("https://quest.howeverina.studio/redirect"),d.value=encodeURIComponent("https://quest.howeverina.studio/login"),s.value=window.crypto.randomUUID(),console.log("state",s.value)}),(o,e)=>{const u=m;return b(),y(U,null,[e[4]||(e[4]=t("link",{rel:"redirect_uri",href:"/redirect"},null,-1)),t("div",S,[t("div",V,[e[2]||(e[2]=t("h3",null,"서버 주소를 입력해주세요.",-1)),$(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>C(a)?a.value=r:a=r),placeholder:"서버 주소"},null,512),[[A,p(a)]]),t("div",{class:"quest-done",onClick:e[1]||(e[1]=r=>f(p(a)))},"로그인")])]),t("div",q,[k(u,{to:"/",class:"u-url p-name"},{default:x(()=>[...e[3]||(e[3]=[I("DailyQuest",-1)])]),_:1})])],64)}}};export{R as default};
